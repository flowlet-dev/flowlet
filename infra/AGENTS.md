# AGENTS.md (infra)

## 適用範囲

- このファイルの指示は `C:\Users\jacks\Documents\flowlet\infra` 配下に適用する。
- ルートの `AGENTS.md` と矛盾する場合は、より制約が強い方を優先する。

## 対象

- 主対象: `docker-compose.prod.yml` と関連運用設定

## 基本方針

- 変更は本番影響を意識し、サービス定義・ネットワーク・ボリュームの整合性を崩さない。
- 既存コンテナ名・ポート・永続化パスは、理由がない限り維持する。
- インフラ変更ではアプリコード改修を混ぜない。

## 実行コマンド

- ルートから: `make up` / `make down` / `make logs` / `make ps`

## 検証方針

- `docker-compose.prod.yml` 変更時は、差分確認後に `make ps` と `make logs` で起動状態を検証する。
- 実行検証できない場合は理由・代替確認・残リスクを明記する。

## 安全方針

- `postgres-prod-data/` は永続データとして扱い、明示指示なしで編集・削除しない。
- 資格情報や機密設定をコミットしない。

## Skills運用

- 正本テンプレート: `docs/SKILLS_POLICY_TEMPLATE.md`
- 更新時はテンプレートを先に更新し、レイヤー固有文言以外を同期する。
- skillは「明示指定された場合」または「タスク内容がskill説明に明確に一致する場合」にのみ使う。
- 複数候補がある場合は、目的達成に必要な最小セットだけを使う。
- skill適用時は、使うskill名と適用理由を1行で先に共有する。
- skill適用時も当該方針を優先する（本番影響を意識し、サービス/ネットワーク/ボリューム整合性を崩さない）。
- skill実行時も既存の安全方針を厳守する（権限昇格は目的を1文で添えて承認を求める）。
- skill実行後は当該ファイルの検証方針に従って確認する。
- 検証不可の場合は、理由・代替確認・残リスクを明記する。
