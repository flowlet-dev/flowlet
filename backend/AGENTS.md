# AGENTS.md (backend)

## 適用範囲

- このファイルの指示は `C:\Users\jacks\Documents\flowlet\backend` 配下に適用する。
- ルートの `AGENTS.md` と矛盾する場合は、より制約が強い方を優先する。

## 対象

- 主対象: `backend/flowlet` (Spring Boot API, Java/Gradle)

## 基本方針

- API仕様に影響する変更は、`Controller -> Service -> Repository` の責務境界を崩さない。
- 例外処理は握りつぶさず、HTTPレスポンスへ一貫した形で返す。
- DBスキーマや永続化仕様に関わる変更は、関連コードを同一変更に閉じる。

## 実行コマンド

- 開発起動: `.\gradlew.bat bootRun`
- テスト: `.\gradlew.bat test`

## 検証方針

- Backend変更時は `.\gradlew.bat test` を必須とする。
- テストが重い場合も、変更箇所に最も近いテストを最低限実行する。
- テスト不可の場合は理由・代替確認・残リスクを明記する。

## 安全方針

- `build/` や `.gradle/` の生成物は、明示指示がない限り変更対象にしない。
- シークレットや接続情報はコード・ログに出力しない。

## Skills運用

- 正本テンプレート: `docs/SKILLS_POLICY_TEMPLATE.md`
- 更新時はテンプレートを先に更新し、レイヤー固有文言以外を同期する。
- skillは「明示指定された場合」または「タスク内容がskill説明に明確に一致する場合」にのみ使う。
- 複数候補がある場合は、目的達成に必要な最小セットだけを使う。
- skill適用時は、使うskill名と適用理由を1行で先に共有する。
- skill適用時も当該方針を優先する（責務境界を崩さず、変更をAPIレイヤー内に閉じる）。
- skill実行時も既存の安全方針を厳守する（権限昇格は目的を1文で添えて承認を求める）。
- skill実行後は当該ファイルの検証方針に従って確認する。
- 検証不可の場合は、理由・代替確認・残リスクを明記する。
